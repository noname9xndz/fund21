var AutocompleteConfig=Object.assign({},DropdownConfig,{useTagNames:!0,tagName:"autocomplete",delay:200,minChar:2,showMark:!1,allowCustomInput:!1,classNameNotFound:"dropdown-header",textNotFound:"No results found"}),AutocompleteUI=Object.assign({},DropdownUI,{Config:AutocompleteConfig,getInput:function(e){return e.querySelector('input:not([type="hidden"])')||!1},getHiddenInput:function(e){return e.querySelector('input[type="hidden"]')||!1},getTriggerElement:function(e){return this.getInput(e)},applyTemplateToMenuItem:function(e,t,n){return e.appendChild(parseTemplate(n,t)),e},getItemLabel:function(e){var t=e.querySelector("[autocompletelabel")||!1;return t?t.textContent:e.textContent},getTemplateSelectLabel:function(e){var t=e.getAttribute("selectedlabel");return!!t&&document.getElementById(t)}}),Autocomplete=Object.assign({},Dropdown,{UI:AutocompleteUI,Config:AutocompleteConfig,init:function(e){return void 0===e.__bunny_autocomplete&&(e.__bunny_autocomplete={},e.__bunny_autocomplete_state=this.getCurState(e),this._addEvents(e),this._setARIA(e),initObjectExtensions(this,e),!0)},_setARIA:function(e){Dropdown._setARIA(e);var t=this.UI.getInput(e);t.setAttribute("role","combobox"),t.setAttribute("aria-autocomplete","list")},close:function(e){Dropdown.close.call(this,e),this.UI.removeMenuItems(e)},_addEvents:function(e){var t=this,n=this.UI.getInput(e);this._addEventFocus(e,n),this.onItemSelect(e,function(n){null===n?t._selectItem(e,!1):t._selectItem(e,n)})},isCustomValueAllowed:function(e){return e.hasAttribute("custom")||this.Config.allowCustomInput},getCustomItemContentsTemplate:function(e){return e.getAttribute("template")},isMarkDisplayed:function(e){return e.hasAttribute("mark")||this.Config.showMark},getMinChar:function(e){return e.hasAttribute("min")?e.getAttribute("min"):this.Config.minChar},isNotFoundDisplayed:function(e){return e.hasAttribute("shownotfound")},_addEventInput:function(e,t){var n=this;e.__bunny_autocomplete_input=addEventOnce(t,"input",function(){t.value.length>=n.getMinChar(e)?n.update(e,t.value):n.close(e)},this.Config.delay)},_addEventFocus:function(e,t){var n=this;t.addEventListener("focus",function(){void 0===e.__bunny_autocomplete_focus&&(e.__bunny_autocomplete_focus=!0,e.__bunny_autocomplete_initial_value=t.value,n._addEventFocusOut(e,t),n._addEventInput(e,t),e.__bunny_autocomplete_keydown_closed=addEvent(t,"keydown",function(u){u.keyCode===KEY_SPACE&&u.stopPropagation(),u.keyCode===KEY_ENTER&&(u.preventDefault(),0===t.value.length?n.clear(e):u.target===t&&n.isCustomValueAllowed(e)&&(n._selectItem(e,!1),n._callItemSelectCallbacks(e,null)))}))})},_addEventFocusOut:function(e,t){var n=this,u=addEvent(t,"blur",function(){setTimeout(function(){n.UI.isMenuItem(e,document.activeElement)||(delete e.__bunny_autocomplete_focus,removeEvent(t,"blur",u),removeEvent(t,"input",e.__bunny_autocomplete_input),delete e.__bunny_autocomplete_input,removeEvent(t,"keydown",e.__bunny_autocomplete_keydown_closed),delete e.__bunny_autocomplete_keydown_closed,0===t.value.length?n.clear(e):!n.isCustomValueAllowed(e)&&n.isStateChanged(e)&&n.restoreState(e))},300)})},_addItemEvents:function(e,t){},update:function(e,t){var n=this;callElementCallbacks(e,"autocomplete_before_update",function(e){e()}),getActionObject(e)(t).then(function(u){if(callElementCallbacks(e,"autocomplete_update",function(e){var t=e(u);void 0!==t&&(u=t)}),Object.keys(u).length>0){n.close(e);var o=void 0,a=n.getCustomItemContentsTemplate(e);o=n.isMarkDisplayed(e)?n.UI.createMenuItems(u,function(e,o,l){a&&(e=n.UI.applyTemplateToMenuItem(e,u[o],a));var i=new RegExp("("+t+")","ig"),s=e.innerHTML.replace(i,"<mark>$1</mark>");return e.innerHTML=s,e}):a?n.UI.createMenuItems(u,function(e,t,o){return n.UI.applyTemplateToMenuItem(e,u[t],a)}):n.UI.createMenuItems(u),n._addItemEvents(e,o),n.UI.setMenuItems(e,o),n._setARIA(e),n.open(e)}else n.close(e),n.isNotFoundDisplayed(e)&&(n.UI.removeMenuItems(e),n.UI.getMenu(e).appendChild(n.createNotFoundElement()),n.open(e))}).catch(function(t){n.UI.getMenu(e).innerHTML=t.message,n.open(e),callElementCallbacks(e,"autocomplete_update",function(e){e(!1,t)})})},createNotFoundElement:function(){var e=document.createElement("div");return e.classList.add(this.Config.classNameNotFound),e.textContent=this.Config.textNotFound,e},onBeforeUpdate:function(e,t){pushCallbackToElement(e,"autocomplete_before_update",t)},onUpdate:function(e,t){pushCallbackToElement(e,"autocomplete_update",t)},restoreState:function(e){var t=this.getState(e);this.UI.getInput(e).value=t.label;var n=this.UI.getHiddenInput(e);n&&(n.value=t.value);var u=this.UI.getTemplateSelectLabel(e);u&&(u.innerHTML=""),this.close(e)},clear:function(e){var t=this.UI.getInput(e),n=this.UI.getHiddenInput(e);t.value="",n&&(n.value=""),e.__bunny_autocomplete_state=this.getCurState(e);var u=this.UI.getTemplateSelectLabel(e);u&&(u.innerHTML=""),this._callItemSelectCallbacks(e,!1),this.close(e)},getValue:function(e){var t=this.UI.getHiddenInput(e);return t?t.value:this.UI.getInput(e).value},getState:function(e){return e.__bunny_autocomplete_state},getCurState:function(e){var t={},n=this.UI.getInput(e),u=this.UI.getHiddenInput(e);return t.label=n.value,u&&(t.value=u.value),t},isStateChanged:function(e){return JSON.stringify(this.getState(e))!==JSON.stringify(this.getCurState(e))},_updateInputValues:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.UI.getInput(e);if(t!==!1){var u=this.UI.getItemLabel(t);n.value=u,e.__bunny_autocomplete_initial_value=u}else this.isCustomValueAllowed(e)?e.__bunny_autocomplete_initial_value=n.value:(n.value="",e.__bunny_autocomplete_initial_value="");var o=this.UI.getHiddenInput(e);o&&(t!==!1?o.value=this.UI.getItemValue(t):this.isCustomValueAllowed(e)?o.value=n.value:o.value="");var a=this.UI.getTemplateSelectLabel(e);a&&(a.innerHTML=t===!1?"":t.innerHTML),e.__bunny_autocomplete_state=this.getCurState(e)},_selectItem:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t!==!1||this.isCustomValueAllowed(e)?this._updateInputValues(e,t):this.restoreState(e),this.close(e)}});document.addEventListener("DOMContentLoaded",function(){Autocomplete.initAll()});