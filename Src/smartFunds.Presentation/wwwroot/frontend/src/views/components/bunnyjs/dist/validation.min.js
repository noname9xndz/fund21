var ValidationConfig={classInputGroup:"form-group",classInputGroupError:"has-danger",classInputGroupSuccess:"has-success",classLabel:"form-control-label",tagNameError:"small",classError:"text-help",selectorInput:"[name]"},ValidationLang={required:"'{label}' is required",email:"'{label}' should be a valid e-mail address",url:"{label} should be a valid website URL",tel:"'{label}' is not a valid telephone number",maxLength:"'{label}' length must be < '{maxLength}'",minLength:"'{label}' length must be > '{minLength}'",maxFileSize:"Max file size must be < {maxFileSize}MB, uploaded {fileSize}MB",image:"'{label}' should be an image (JPG or PNG)",minImageDimensions:"'{label}' must be > {minWidth}x{minHeight}, uploaded {width}x{height}",maxImageDimensions:"'{label}' must be < {maxWidth}x{maxHeight}, uploaded {width}x{height}",requiredFromList:"Select '{label}' from list",confirmation:"'{label}' is not equal to '{originalLabel}'",minOptions:"Please select at least {minOptionsCount} options"},_bn_getFile=function(e){return void 0!==e._file&&""!==e._file?e._file instanceof Blob!=!1&&e._file:e.files[0]||!1},ValidationValidators={required:function(e){return new Promise(function(t,n){e.hasAttribute("required")&&("file"!==e.getAttribute("type")&&""===e.value||("radio"===e.type||"checkbox"===e.type)&&e.validity.valueMissing||"file"===e.getAttribute("type")&&_bn_getFile(e)===!1)?n():t()})},email:function(e){return new Promise(function(t,n){if(e.value.length>0&&"email"===e.getAttribute("type")){/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i.test(e.value)?t():n()}else t()})},url:function(e){return new Promise(function(t,n){if(e.value.length>0&&"url"===e.getAttribute("type")){/(^|\s)((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)/gi.test(e.value)?t():n()}else t()})},tel:function(e){return new Promise(function(t,n){if(e.value.length>0&&"tel"===e.getAttribute("type")){/^[0-9\-\+\(\)\#\ \*]{6,20}$/.test(e.value)?t():n()}else t()})},maxLength:function(e){return new Promise(function(t,n){null!==e.getAttribute("maxlength")&&e.value.length>e.getAttribute("maxlength")?n({maxLength:e.getAttribute("maxlength")}):t()})},minLength:function(e){return new Promise(function(t,n){null!==e.getAttribute("minlength")&&e.value.length<e.getAttribute("minlength")?n({minLength:e.getAttribute("minlength")}):t()})},maxFileSize:function(e){return new Promise(function(t,n){if("file"===e.getAttribute("type")&&e.hasAttribute("maxfilesize")&&_bn_getFile(e)!==!1){var i=parseFloat(e.getAttribute("maxfilesize")),a=(_bn_getFile(e).size/1e6).toFixed(2);a<=i?t(e):n({maxFileSize:i,fileSize:a})}else t(e)})},image:function(e){return new Promise(function(t,n){"file"===e.getAttribute("type")&&e.getAttribute("accept").indexOf("image")>-1&&_bn_getFile(e)!==!1?BunnyFile.getSignature(_bn_getFile(e)).then(function(e){BunnyFile.isJpeg(e)||BunnyFile.isPng(e)?t():n({signature:e})}).catch(function(e){n(e)}):t()})},minImageDimensions:function(e){return new Promise(function(t,n){if(e.hasAttribute("mindimensions")&&_bn_getFile(e)!==!1){var i=e.getAttribute("mindimensions").split("x"),a=babelHelpers.slicedToArray(i,2),r=a[0],o=a[1];BunnyImage.getImageByBlob(_bn_getFile(e)).then(function(e){var i=BunnyImage.getImageWidth(e),a=BunnyImage.getImageHeight(e);i<r||a<o?n({width:i,height:a,minWidth:r,minHeight:o}):t()}).catch(function(e){n(e)})}else t()})},maxImageDimensions:function(e){return new Promise(function(t,n){if(e.hasAttribute("maxdimensions")&&_bn_getFile(e)!==!1){var i=e.getAttribute("maxdimensions").split("x"),a=babelHelpers.slicedToArray(i,2),r=a[0],o=a[1];BunnyImage.getImageByBlob(_bn_getFile(e)).then(function(e){var i=BunnyImage.getImageWidth(e),a=BunnyImage.getImageHeight(e);i>r||a>o?n({width:i,height:a,maxWidth:r,maxHeight:o}):t()}).catch(function(e){n(e)})}else t()})},requiredFromList:function(e){return new Promise(function(t,n){var i=void 0;i=e.hasAttribute("requiredfromlist")?e.getAttribute("requiredfromlist"):e.name+"_id";var a=document.getElementById(i);a?a.value.length>0?t():n():t()})},minOptions:function(e){return new Promise(function(t,n){if(e.hasAttribute("minoptions")){var i=parseInt(e.getAttribute("minoptions")),a=ValidationUI.getInputGroup(e),r=a.getElementsByTagName("input"),o=0;[].forEach.call(r,function(t){t!==e&&""!==t.value&&o++}),o<i?n({minOptionsCount:i}):t()}else t()})},confirmation:function(e){return new Promise(function(t,n){if(e.name.indexOf("_confirmation")>-1){var i=e.name.substr(0,e.name.length-13),a=document.getElementById(i);a.value==e.value?t():n({originalLabel:ValidationUI.getLabel(ValidationUI.getInputGroup(a)).textContent})}else t()})},ajax:function(e){return new Promise(function(t,n){if(void 0!==e.dataset.ajax&&e.value.length>0){var i=e.dataset.ajax.replace("{value}",encodeURIComponent(e.value));Ajax.get(i,function(e){e=JSON.parse(e),void 0!==e.message&&""!==e.message?n(e.message):t()},function(){n("Ajax error")})}else t()})}},ValidationUI={config:ValidationConfig,insertErrorNode:function(e,t){e.appendChild(t)},toggleErrorClass:function(e){e.classList.toggle(this.config.classInputGroupError)},createErrorNode:function(){var e=document.createElement(this.config.tagNameError);return e.classList.add(this.config.classError),e},getErrorNode:function(e){return e.getElementsByClassName(this.config.classError)[0]||!1},removeErrorNode:function(e){var t=this.getErrorNode(e);t&&(t.parentNode.removeChild(t),this.toggleErrorClass(e))},removeErrorNodesFromSection:function(e){var t=this;[].forEach.call(this.getInputGroupsInSection(e),function(e){t.removeErrorNode(e)})},setErrorMessage:function(e,t){var n=this.getErrorNode(e);n===!1&&(n=this.createErrorNode(),this.toggleErrorClass(e),this.insertErrorNode(e,n)),n.textContent=t},setInputValid:function(e){e.classList.add(this.config.classInputGroupSuccess)},getInput:function(e){return e.querySelector(this.config.selectorInput)||!1},getInputGroup:function(e){for(var t=e;(t=t.parentNode)&&!t.classList.contains(this.config.classInputGroup););return t},getInputsInSection:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getInputGroupsInSection(e),i=void 0;i=t?{inputs:{},invalidInputs:{},length:0,unresolvedLength:0,invalidLength:0}:[];for(var a=0;a<n.length;a++){var r=this.getInput(n[a]);if(r===!1)throw new Error("Bunny Validation: Input group has no input");t?(i.inputs[a]={input:r,isValid:null},i.length++,i.unresolvedLength++):i.push(r)}return i},getLabel:function(e){return e.getElementsByTagName("label")[0]||!1},getInputGroupsInSection:function(e){return e.getElementsByClassName(this.config.classInputGroup)}},Validation={validators:ValidationValidators,lang:ValidationLang,ui:ValidationUI,init:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.setAttribute("novalidate",""),e.addEventListener("submit",function(n){n.preventDefault();var i=e.querySelectorAll('[type="submit"]');[].forEach.call(i,function(e){e.disabled=!0}),t.validateSection(e).then(function(n){[].forEach.call(i,function(e){e.disabled=!1}),n===!0?e.submit():t.focusInput(n[0])})}),n&&this.initInline(e)},initInline:function(e){var t=this;this.ui.getInputsInSection(e).forEach(function(e){e.addEventListener("change",function(){t.checkInput(e).catch(function(e){})})})},validateSection:function(e){var t=this;if(void 0!==e.__bunny_validation_state)throw new Error("Bunny Validation: validation already in progress.");return e.__bunny_validation_state=!0,new Promise(function(n){var i=t.ui.getInputsInSection(e,!0);if(0===i.length)t._endSectionValidation(e,i,n);else{for(var a=0;a<i.length;a++)!function(a){var r=i.inputs[a].input;t.checkInput(r).then(function(){t._addValidInput(i,r),0===i.unresolvedLength&&t._endSectionValidation(e,i,n)}).catch(function(a){t._addInvalidInput(i,r),0===i.unresolvedLength&&t._endSectionValidation(e,i,n)})}(a);setTimeout(function(){if(i.unresolvedLength>0)for(var a=t._getUnresolvedInputs(i),r=0;r<a.length;r++){var o=a[r],u=t.ui.getInputGroup(o);t._addInvalidInput(i,o),t.ui.setErrorMessage(u,"Validation terminated after 3s"),0===i.unresolvedLength&&t._endSectionValidation(e,i,n)}},3e3)}})},focusInput:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-50;BunnyElement.scrollTo(e,t,n),e.focus(),null!==e.offsetParent&&void 0!==e.setSelectionRange&&["text","search","url","tel","password"].indexOf(e.type)!==-1&&"function"==typeof e.setSelectionRange&&e.setSelectionRange(e.value.length,e.value.length)},checkInput:function(e){var t=this;return new Promise(function(n,i){t._checkInput(e,0,n,i)})},_addValidInput:function(e,t){e.unresolvedLength--;for(var n in e.inputs)if(t===e.inputs[n].input){e.inputs[n].isValid=!0;break}},_addInvalidInput:function(e,t){e.unresolvedLength--,e.invalidLength++;for(var n in e.inputs)if(t===e.inputs[n].input){e.inputs[n].isValid=!1,e.invalidInputs[n]=t;break}},_getUnresolvedInputs:function(e){var t=[];for(var n in e.inputs)e.inputs[n].isValid||t.push(e.inputs[n].input);return t},_endSectionValidation:function(e,t,n){if(delete e.__bunny_validation_state,0===t.invalidLength)return n(!0);var i=[];for(var a in t.invalidInputs)i.push(t.invalidInputs[a]);return n(i)},_checkInput:function(e,t,n,i){var a=this,r=Object.keys(this.validators),o=r[t];(0,this.validators[o])(e).then(function(){if(t++,void 0!==r[t])a._checkInput(e,t,n,i);else{var o=a.ui.getInputGroup(e);a.ui.removeErrorNode(o),e.form&&e.form.hasAttribute("showvalid")&&a.ui.setInputValid(o),n()}}).catch(function(t){if(void 0!==t&&void 0!==t.message)throw t;var n=a.ui.getInputGroup(e),r=a.ui.getLabel(n),u=a._getErrorMessage(o,e,r,t);a.ui.setErrorMessage(n,u),i(u)})},_getErrorMessage:function(e,t,n,i){var a="";if("string"==typeof i)a=i;else{if(void 0===this.lang[e])throw new Error("Bunny Validation: Lang message not found for validator: "+e);a=this.lang[e]}a=a.replace("{label}",this._getInputTitle(t,n));for(var r in i)a=a.replace("{"+r+"}",i[r]);return a},_getInputTitle:function(e,t){return t!==!1?t.textContent:e.placeholder&&""!==e.placeholder?e.placeholder:e.getAttribute("aria-label")&&""!==e.getAttribute("aria-label")?e.getAttribute("aria-label"):e.name&&""!==e.name?e.name:""}};document.addEventListener("DOMContentLoaded",function(){[].forEach.call(document.forms,function(e){if("bunny"===e.getAttribute("validator")){var t=e.hasAttribute("validator-inline");Validation.init(e,t)}})});